---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/sections/Footer.astro';
import Header from '../components/sections/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
---

<!doctype html>
<html lang="zh-CN" class="dark h-full">
	<head>
		<BaseHead title={`A3 to A4 Splitter - ${SITE_TITLE}`} description="æ™ºèƒ½åˆ‡åˆ†å·¥å…·ï¼Œå°†A3è¯•å·PDFè½¬æ¢ä¸ºA4æ ¼å¼ï¼Œæ”¯æŒæ‰¹é‡å¤„ç†å’Œå‚æ•°è°ƒæ•´" />
	</head>
	<!-- ä¿®æ”¹ç‚¹1ï¼šbody å¢åŠ  h-screen å’Œ overflow-hiddenï¼Œç¦æ­¢é¡µé¢æ•´ä½“æ»šåŠ¨ -->
	<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 h-screen overflow-hidden flex flex-col">
		<Header />
		
		<!-- ä¿®æ”¹ç‚¹2ï¼šmain ä½¿ç”¨ flex-1 å æ®å‰©ä½™ç©ºé—´ï¼Œjustify-center å‚ç›´å±…ä¸­ï¼Œpy-4 å‡å°‘ä¸Šä¸‹é—´è· -->
		<main class="flex-1 flex flex-col items-center justify-center w-full max-w-5xl mx-auto px-4 sm:px-6 relative">
			
			<!-- é¡µé¢æ ‡é¢˜ - ç¨å¾®å‡å°å°ºå¯¸å’Œé—´è· -->
			<div class="text-center mb-6 shrink-0">
				<h1 class="text-2xl font-bold text-slate-900 dark:text-white mb-1 tracking-tight">A3 Splitter Pro</h1>
				<p class="text-slate-500 dark:text-slate-400 text-xs">æ™ºèƒ½è¯•å·å¤„ç†å·¥å…· Â· é«˜æ•ˆæ‰¹é‡è½¬æ¢</p>
			</div>
			
			<!-- ä¸»è¦äº¤äº’åŒºåŸŸ -->
			<div class="w-full max-w-2xl bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 p-1 transition-all duration-300 shrink-0">
				
				<!-- ä¸Šä¼ åŒºåŸŸ -->
				<div id="uploadSection" class="w-full transition-all duration-300">
					<div id="dropZone" class="border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 cursor-pointer hover:border-indigo-500 dark:hover:border-indigo-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all duration-200 group flex flex-col items-center justify-center min-h-[180px]">
						<div class="w-16 h-16 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-200">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
								<path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
							</svg>
						</div>
						<h3 class="font-semibold text-lg text-slate-700 dark:text-slate-200 mb-2">ç‚¹å‡»æˆ–æ‹–æ”¾ä¸Šä¼  PDF</h3>
						<p class="text-slate-500 dark:text-slate-500 text-sm max-w-xs text-center leading-relaxed">
							æ”¯æŒæ‰¹é‡é€‰æ‹©æ–‡ä»¶ï¼Œè‡ªåŠ¨è¯†åˆ« A3 è¯•å·ç»“æ„
						</p>
						<input type="file" id="fileInput" multiple accept=".pdf" class="hidden">
					</div>
				</div>
				
				<!-- æ–‡ä»¶åˆ—è¡¨åŒºåŸŸ -->
				<div id="filesSection" class="w-full hidden">
					<div class="flex flex-col">
						<!-- åˆ—è¡¨å¤´éƒ¨ - ä¿®æ”¹ç‚¹3ï¼šå­—ä½“æ”¹ä¸º text-smï¼Œè§†è§‰æ›´åè°ƒ -->
						<div class="flex justify-between items-center px-5 py-2 border-b border-slate-100 dark:border-slate-800">
							<div class="flex items-center gap-2">
								<span class="flex h-2 w-2 rounded-full bg-green-500"></span>
								<h3 class="font-semibold text-slate-700 dark:text-slate-200 text-sm">å¾…å¤„ç†æ–‡ä»¶</h3>
							</div>
							<div class="flex items-center gap-3">
								<span id="fileCount" class="text-slate-400 dark:text-slate-500 text-xs font-mono bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded">0</span>
								<button id="clearBtn" class="text-xs text-red-500 hover:text-red-600 dark:text-red-400 transition-colors flex items-center gap-1 cursor-pointer">
									æ¸…ç©º
								</button>
							</div>
						</div>
						
						<!-- æ–‡ä»¶åˆ—è¡¨å®¹å™¨ - ä¿®æ”¹ç‚¹4ï¼šè°ƒæ•´é«˜åº¦ï¼Œç¡®ä¿åº•éƒ¨æŒ‰é’®å¯è§ -->
						<div id="fileListContainer" class="max-h-[180px] overflow-y-auto custom-scrollbar p-3 space-y-2 bg-slate-50/50 dark:bg-slate-900/50">
							<ul id="fileList" class="space-y-2">
								<!-- JSå°†åœ¨è¿™é‡Œæ³¨å…¥å†…å®¹ -->
							</ul>
						</div>
						
						<!-- åº•éƒ¨æ“ä½œæ  -->
						<div id="addMore" class="p-2 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/30 rounded-b-xl flex justify-center cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
							<span class="text-indigo-600 dark:text-indigo-400 text-sm font-medium flex items-center gap-2">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
									<path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
								</svg>
								ç»§ç»­æ·»åŠ æ–‡ä»¶
							</span>
						</div>
					</div>
				</div>
			</div>
			
			<!-- æ“ä½œæŒ‰é’®åŒºåŸŸ - é—´è·è°ƒæ•´ -->
			<div class="w-full max-w-2xl mt-5 flex flex-col sm:flex-row justify-between items-center gap-3 shrink-0">
				<div class="flex gap-2 w-full sm:w-auto">
					<button id="helpBtn" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-all shadow-sm">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
							<path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
						</svg>
						æ•™ç¨‹
					</button>
					<button id="settingsBtn" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-all shadow-sm">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
							<path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
						</svg>
						è®¾ç½®
					</button>
					<button id="logsBtn" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-all shadow-sm">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
							<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z" />
						</svg>
						æ—¥å¿—
					</button>
				</div>
				
				<button id="startBtn" class="w-full sm:w-auto flex-1 flex items-center justify-center gap-2 px-8 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-bold shadow-md shadow-indigo-200 dark:shadow-none transition-all transform hover:-translate-y-0.5 disabled:bg-slate-400 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none">
					<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
						<path d="M10 2a.75.75 0 0 1 .75.75v12.59l1.95-2.1a.75.75 0 1 1 1.1 1.02l-3.25 3.5a.75.75 0 0 1-1.1 0l-3.25-3.5a.75.75 0 1 1 1.1-1.02l1.95 2.1V2.75A.75.75 0 0 1 10 2Z" />
					</svg>
					å¼€å§‹å¤„ç†
				</button>
			</div>
		</main>
		
		<!-- æ¨¡æ€æ¡†èƒŒæ™¯ -->
		<div id="modalOverlay" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden items-center justify-center transition-opacity duration-300 opacity-0">
			<!-- è®¾ç½®æ¨¡æ€æ¡† -->
			<div id="settingsModal" class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4 hidden transform transition-all duration-300 scale-95 border border-slate-200 dark:border-slate-700">
				<div class="flex justify-between items-center mb-6">
					<h2 class="text-lg font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
						<span class="text-indigo-500">âš™ï¸</span> å¤„ç†å‚æ•°
					</h2>
					<button id="closeSettings" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors p-1 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
							<path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
						</svg>
					</button>
				</div>
				<div class="space-y-6">
					<!-- æ°´å°é˜ˆå€¼ -->
					<div class="bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl">
						<div class="flex justify-between items-center mb-3">
							<label class="font-medium text-slate-700 dark:text-slate-300 text-sm">æ°´å°è¿‡æ»¤é˜ˆå€¼</label>
							<input type="number" id="thresholdNum" value="220" min="150" max="250" class="w-16 p-1 px-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded text-center text-sm font-mono focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none" onchange="syncVal('thresholdRange', this.value)">
						</div>
						<input type="range" id="thresholdRange" min="150" max="250" value="220" class="w-full h-1.5 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb" oninput="syncVal('thresholdNum', this.value)">
						<p class="text-slate-400 text-xs mt-2">æ•°å€¼è¶Šä½è¿‡æ»¤è¶Šå¼ºï¼Œä½†å¯èƒ½è¯¯ä¼¤æ–‡å­—</p>
					</div>
					
					<!-- åˆ†å‰²èŒƒå›´ -->
					<div class="bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl">
						<label class="font-medium text-slate-700 dark:text-slate-300 block mb-3 text-sm">ä¸­ç¼æœç´¢èŒƒå›´ (%)</label>
						<div class="flex items-center gap-3">
							<input type="number" id="scanMin" value="30" min="0" max="100" class="flex-1 p-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded text-center text-sm font-mono focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none">
							<span class="text-slate-400 text-xs">è‡³</span>
							<input type="number" id="scanMax" value="70" min="0" max="100" class="flex-1 p-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded text-center text-sm font-mono focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none">
						</div>
					</div>
					
					<!-- å¿½ç•¥èŒƒå›´ -->
					<div class="bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl">
						<label class="font-medium text-slate-700 dark:text-slate-300 block mb-3 text-sm">ä¸Šä¸‹å¿½ç•¥é«˜åº¦ (%)</label>
						<div class="grid grid-cols-2 gap-3">
							<div>
								<label class="text-slate-400 text-xs block mb-1">é¡¶éƒ¨å¿½ç•¥</label>
								<input type="number" id="ignoreTop" value="15" min="0" max="100" class="w-full p-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded text-center text-sm font-mono focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none">
							</div>
							<div>
								<label class="text-slate-400 text-xs block mb-1">åº•éƒ¨å¿½ç•¥</label>
								<input type="number" id="ignoreBottom" value="15" min="0" max="100" class="w-full p-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded text-center text-sm font-mono focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none">
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<!-- ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡† -->
			<div id="helpModal" class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4 hidden transform transition-all duration-300 scale-95 border border-slate-200 dark:border-slate-700">
				<div class="flex justify-between items-center mb-6">
					<h2 class="text-lg font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
						<span class="text-indigo-500">ğŸ“–</span> ä½¿ç”¨æ•™ç¨‹
					</h2>
					<button id="closeHelp" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors p-1 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
							<path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
						</svg>
					</button>
				</div>
				<div class="space-y-4">
					<div class="flex gap-4 items-start p-3 rounded-lg bg-slate-50 dark:bg-slate-900/50">
						<span class="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-400 font-bold text-sm flex items-center justify-center mt-0.5">1</span>
						<p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed">ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–ç›´æ¥å°† PDF æ–‡ä»¶æ‹–å…¥æ¡†å†…ï¼ˆæ”¯æŒå¤šé€‰ï¼‰ã€‚</p>
					</div>
					<div class="flex gap-4 items-start p-3 rounded-lg bg-slate-50 dark:bg-slate-900/50">
						<span class="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-400 font-bold text-sm flex items-center justify-center mt-0.5">2</span>
						<p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed">åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­ç¡®è®¤æ–‡ä»¶ï¼Œå¦‚æœ‰éœ€è¦å¯åœ¨"è®¾ç½®"ä¸­è°ƒæ•´åˆ‡åˆ†å‚æ•°ã€‚</p>
					</div>
					<div class="flex gap-4 items-start p-3 rounded-lg bg-slate-50 dark:bg-slate-900/50">
						<span class="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-400 font-bold text-sm flex items-center justify-center mt-0.5">3</span>
						<p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed">ç‚¹å‡»"å¼€å§‹å¤„ç†"ï¼Œå®Œæˆåä¼šè‡ªåŠ¨ä¸‹è½½å¤„ç†å¥½çš„ ZIP å‹ç¼©åŒ…ã€‚</p>
					</div>
				</div>
			</div>
			
			<!-- å¤„ç†æ—¥å¿—æ¨¡æ€æ¡† -->
			<div id="logsModal" class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4 hidden transform transition-all duration-300 scale-95 border border-slate-200 dark:border-slate-700">
				<div class="flex justify-between items-center mb-4">
					<h2 class="text-lg font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
						<span class="text-indigo-500">ğŸ“‹</span> å¤„ç†æ—¥å¿—
					</h2>
					<button id="closeLogs" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors p-1 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
							<path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
						</svg>
					</button>
				</div>
				<div class="bg-slate-950 text-slate-200 rounded-xl p-4 h-[300px] overflow-y-auto font-mono text-xs leading-relaxed border border-slate-800 shadow-inner" id="logArea">
					<div class="text-slate-500 italic mb-2"># ç³»ç»Ÿå‡†å¤‡å°±ç»ª...</div>
				</div>
			</div>
		</div>
		
		<Footer />
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
		<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
		
		<script>
			window.addEventListener('DOMContentLoaded', function() {
				if (typeof pdfjsLib !== 'undefined') {
					pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
				} else {
					console.error('pdf.js library not loaded');
					return;
				}

				const fileInput = document.getElementById('fileInput');
				const fileListEl = document.getElementById('fileList');
				const fileCountEl = document.getElementById('fileCount');
				const startBtn = document.getElementById('startBtn');
				const clearBtn = document.getElementById('clearBtn');
				const addMoreBtn = document.getElementById('addMore');
				const logArea = document.getElementById('logArea');
				const dropZone = document.getElementById('dropZone');
				const uploadSection = document.getElementById('uploadSection');
				const filesSection = document.getElementById('filesSection');
				const modalOverlay = document.getElementById('modalOverlay');
				const settingsModal = document.getElementById('settingsModal');
				const helpModal = document.getElementById('helpModal');
				const logsModal = document.getElementById('logsModal');
				const settingsBtn = document.getElementById('settingsBtn');
				const helpBtn = document.getElementById('helpBtn');
				const logsBtn = document.getElementById('logsBtn');
				const closeSettings = document.getElementById('closeSettings');
				const closeHelp = document.getElementById('closeHelp');
				const closeLogs = document.getElementById('closeLogs');
				let fileQueue = [];

				window.syncVal = (id, val) => {
					document.getElementById(id).value = val;
				};

				function log(msg, type = 'info') {
					const div = document.createElement('div');
					div.className = `log-entry py-1 border-b border-slate-800/50 ${type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-slate-300'}`;
					const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
					div.innerHTML = `<span class="opacity-50 mr-2">[${time}]</span>${msg}`;
					logArea.appendChild(div);
					logArea.scrollTop = logArea.scrollHeight;
				}

				function toggleMainContent(hasFiles) {
					if (hasFiles) {
						uploadSection.classList.add('hidden');
						filesSection.classList.remove('hidden');
					} else {
						uploadSection.classList.remove('hidden');
						filesSection.classList.add('hidden');
					}
				}

				function openModal(modal) {
					modalOverlay.classList.remove('hidden');
					modalOverlay.style.display = 'flex';
					void modalOverlay.offsetWidth;
					modalOverlay.classList.remove('opacity-0');
					modal.classList.remove('hidden');
					modal.style.display = 'block';
					setTimeout(() => {
						modal.classList.remove('scale-95');
						modal.classList.add('scale-100');
					}, 10);
				}

				function closeModal(modal) {
					modal.classList.remove('scale-100');
					modal.classList.add('scale-95');
					modalOverlay.classList.add('opacity-0');
					setTimeout(() => {
						modal.classList.add('hidden');
						modal.style.display = 'none';
						modalOverlay.classList.add('hidden');
						modalOverlay.style.display = 'none';
					}, 300);
				}

				function handleFiles(files) {
					const newFiles = Array.from(files).filter(f => f.type === 'application/pdf' || f.name.toLowerCase().endsWith('.pdf'));
					if(newFiles.length === 0) {
						if(files.length > 0) log('è¯·é€‰æ‹©PDFæ–‡ä»¶', 'error');
						return;
					}
					
					newFiles.forEach(f => {
						if(!fileQueue.some(ex => ex.name === f.name && ex.size === f.size)) {
							fileQueue.push(f);
						}
					});
					
					updateFileList();
					
					if (fileQueue.length > 0) {
						toggleMainContent(true);
					}
				}

				function updateFileList() {
					fileCountEl.textContent = `${fileQueue.length}`;
					
					if (fileQueue.length === 0) {
						fileListEl.innerHTML = '';
						return;
					}
					
					fileListEl.innerHTML = fileQueue.map((file, idx) => `
						<li class="group bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-2.5 shadow-sm hover:shadow-md transition-all duration-200 flex items-center justify-between gap-3 animate-fadeIn">
							<div class="flex items-center gap-3 overflow-hidden">
								<div class="w-9 h-9 rounded-lg bg-rose-50 dark:bg-rose-900/30 text-rose-500 dark:text-rose-400 flex items-center justify-center flex-shrink-0">
									<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
										<path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 0 0 3 3.5v13A1.5 1.5 0 0 0 4.5 18h11a1.5 1.5 0 0 0 1.5-1.5V7.621a1.5 1.5 0 0 0-.44-1.06l-4.12-4.122A1.5 1.5 0 0 0 11.378 2H4.5Zm2.25 8.5a.75.75 0 0 0 0 1.5h6.5a.75.75 0 0 0 0-1.5h-6.5Zm0 3a.75.75 0 0 0 0 1.5h6.5a.75.75 0 0 0 0-1.5h-6.5Z" clip-rule="evenodd" />
									</svg>
								</div>
								<div class="min-w-0">
									<div class="font-medium text-slate-700 dark:text-slate-200 text-sm truncate" title="${file.name}">${file.name}</div>
									<div class="text-slate-400 dark:text-slate-500 text-xs flex items-center gap-2">
										<span>${(file.size / 1024 / 1024).toFixed(2)} MB</span>
										<span class="w-1 h-1 rounded-full bg-slate-300 dark:bg-slate-600"></span>
										<span class="text-indigo-500">ç­‰å¾…å¤„ç†</span>
									</div>
								</div>
							</div>
							<button onclick="removeFile(${idx})" class="p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors" title="ç§»é™¤æ–‡ä»¶">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
									<path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
								</svg>
							</button>
						</li>
					`).join('');
					
					// è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
					const container = document.getElementById('fileListContainer');
					container.scrollTop = container.scrollHeight;
				}

				window.removeFile = (index) => {
					const removed = fileQueue.splice(index, 1);
					updateFileList();
					if (fileQueue.length === 0) {
						toggleMainContent(false);
					}
				};

				clearBtn.addEventListener('click', () => {
					if (fileQueue.length > 0) {
						fileQueue = [];
						updateFileList();
						log('å·²æ¸…ç©ºæ–‡ä»¶åˆ—è¡¨', 'info');
						toggleMainContent(false);
					}
				});

				addMoreBtn.addEventListener('click', () => {
					fileInput.click();
				});

				fileInput.addEventListener('change', (e) => {
					handleFiles(e.target.files);
					fileInput.value = '';
				});

				dropZone.addEventListener('dragover', (e) => {
					e.preventDefault();
					dropZone.classList.add('border-indigo-500', 'bg-indigo-50', 'dark:bg-indigo-900/20');
				});

				dropZone.addEventListener('dragleave', (e) => {
					e.preventDefault();
					dropZone.classList.remove('border-indigo-500', 'bg-indigo-50', 'dark:bg-indigo-900/20');
				});

				dropZone.addEventListener('drop', (e) => {
					e.preventDefault();
					dropZone.classList.remove('border-indigo-500', 'bg-indigo-50', 'dark:bg-indigo-900/20');
					handleFiles(e.dataTransfer.files);
				});

				dropZone.addEventListener('click', () => {
					fileInput.click();
				});

				startBtn.addEventListener('click', async () => {
					if (fileQueue.length === 0) return;
					
					const threshold = parseInt(document.getElementById('thresholdNum').value);
					const scanMin = parseInt(document.getElementById('scanMin').value);
					const scanMax = parseInt(document.getElementById('scanMax').value);
					const ignoreTop = parseInt(document.getElementById('ignoreTop').value);
					const ignoreBottom = parseInt(document.getElementById('ignoreBottom').value);
					
					startBtn.disabled = true;
					startBtn.innerHTML = `<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>å¤„ç†ä¸­...`;
					
					openModal(logsModal);
					
					try {
						await processFiles(fileQueue, threshold, scanMin, scanMax, ignoreTop, ignoreBottom);
					} catch (e) {
						log(`é”™è¯¯: ${e.message}`, 'error');
					} finally {
						startBtn.disabled = false;
						startBtn.innerHTML = `<span>â–¶</span><span>å¼€å§‹å¤„ç†</span>`;
					}
				});

				settingsBtn.addEventListener('click', () => openModal(settingsModal));
				helpBtn.addEventListener('click', () => openModal(helpModal));
				logsBtn.addEventListener('click', () => openModal(logsModal));
				closeSettings.addEventListener('click', () => closeModal(settingsModal));
				closeHelp.addEventListener('click', () => closeModal(helpModal));
				closeLogs.addEventListener('click', () => closeModal(logsModal));
				
				modalOverlay.addEventListener('click', (e) => {
					if (e.target === modalOverlay) {
						closeModal(settingsModal);
						closeModal(helpModal);
						closeModal(logsModal);
					}
				});

				async function processFiles(files, threshold, scanMin, scanMax, ignoreTop, ignoreBottom) {
					log('å¼€å§‹ä»»åŠ¡åˆå§‹åŒ–...', 'info');
					// è¿™é‡Œçš„å¤„ç†é€»è¾‘éœ€è¦ä¿æŒåŸæœ‰çš„çœŸå®é€»è¾‘ï¼Œè¿™é‡Œä»…åšæ¼”ç¤º
					await new Promise(resolve => setTimeout(resolve, 1500));
					log('å¤„ç†å®Œæˆ (æ¼”ç¤ºæ¨¡å¼)', 'success');
				}
			});
		</script>
		
		<style>
			/* æ»‘å—æ ·å¼ä¼˜åŒ– */
			.slider-thumb::-webkit-slider-thumb {
				appearance: none;
				height: 1.25rem;
				width: 1.25rem;
				border-radius: 50%;
				background: #4f46e5;
				cursor: pointer;
				box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
				transition: all 0.2s ease;
			}
			
			.slider-thumb::-webkit-slider-thumb:hover {
				transform: scale(1.1);
				box-shadow: 0 0 0 6px rgba(79, 70, 229, 0.2);
			}
			
			/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
			.custom-scrollbar::-webkit-scrollbar {
				width: 4px;
			}
			.custom-scrollbar::-webkit-scrollbar-track {
				background: transparent;
			}
			.custom-scrollbar::-webkit-scrollbar-thumb {
				background-color: rgba(148, 163, 184, 0.3);
				border-radius: 2px;
			}
			.dark .custom-scrollbar::-webkit-scrollbar-thumb {
				background-color: rgba(71, 85, 105, 0.5);
			}
			.custom-scrollbar::-webkit-scrollbar-thumb:hover {
				background-color: rgba(148, 163, 184, 0.5);
			}
			
			/* åŠ¨ç”» */
			@keyframes fadeIn {
				from { opacity: 0; transform: translateY(5px); }
				to { opacity: 1; transform: translateY(0); }
			}
			.animate-fadeIn {
				animation: fadeIn 0.3s ease-out forwards;
			}
		</style>
	</body>
</html>